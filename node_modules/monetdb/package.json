{
  "name": "monetdb",
  "version": "1.1.1",
  "description": "Connect MonetDB to your NodeJS app",
  "main": "index.js",
  "scripts": {
    "test": "`npm bin`/mocha Tests/test.js",
    "coverage": "`npm bin`/istanbul cover `npm bin`/_mocha --report lcovonly -- -R spec Tests/test.js",
    "coveralls": "npm run-script coverage && node node_modules/coveralls/bin/coveralls.js < coverage/lcov.info"
  },
  "keywords": [
    "monetdb"
  ],
  "author": {
    "name": "Robin Cijvat",
    "email": "robin.cijvat@monetdbsolutions.com"
  },
  "contributors": [
    {
      "name": "Hannes MÃ¼hleisen",
      "email": "hannes@cwi.nl"
    }
  ],
  "repository": {
    "type": "git",
    "url": "https://github.com/MonetDB/monetdb-nodejs"
  },
  "license": "SEE LICENSE IN LICENSE",
  "devDependencies": {
    "chai": "^3.4.0",
    "chai-as-promised": "^5.1.0",
    "coveralls": "^2.11.4",
    "istanbul": "^0.4.0",
    "mocha": "^2.3.3",
    "mocha-lcov-reporter": "^1.0.0"
  },
  "dependencies": {
    "q": "^1.4.1"
  },
  "readme": "# MonetDB NodeJS connector version 1.\\*\n\n[![Build Status](https://travis-ci.org/MonetDB/monetdb-nodejs.svg)](https://travis-ci.org/MonetDB/monetdb-nodejs)\n[![Coverage Status](https://coveralls.io/repos/MonetDB/monetdb-nodejs/badge.svg?branch=master&service=github)](https://coveralls.io/github/MonetDB/monetdb-nodejs?branch=master)\n[![npm version](https://badge.fury.io/js/monetdb.svg)](https://badge.fury.io/js/monetdb)\n[![Dependency Status](https://david-dm.org/MonetDB/monetdb-nodejs.svg)](https://david-dm.org/MonetDB/monetdb-nodejs)\n\n\nThis NodeJS module provides an easy and powerful way to use MonetDB inside your NodeJS programs.\n\n\nFor version 0.\\* users:\n* **[Click here for documentation of version 0.\\*](https://github.com/MonetDB/monetdb-nodejs/blob/master/docs/README.v0.md)**\n* **[Click here for update notes, including new features, backward compatibility notes, and upgrade instructions](https://github.com/MonetDB/monetdb-nodejs/blob/master/docs/v1-notes.md)**\n\n\n<a name=\"example\"></a>\n## Example usage\n\n```javascript\nvar MDB = require('monetdb')();\n\nvar options = {\n\thost     : 'localhost', \n\tport     : 50000, \n\tdbname   : 'mydb', \n\tuser     : 'monetdb', \n\tpassword : 'monetdb'\n};\n\nvar conn = new MDB(options);\nconn.connect();\n\nconn.query('SELECT * FROM mytable').then(function(result) {\n    // Do something with the result\n});\n\nconn.close();\n```\n\n\n\n<a name=\"options\"></a>\n# Options\nThere are three flavors of setting options:\n1. providing global options\n2. providing local options\n3. changing local options\n\nLet's look at how we could use these flavors to setup connections for multiple users:\n\n```javascript\n// We set the global option 'dbname' to 'db', for all connections\nvar MDB = require('monetdb')({dbname: 'db'});\n\n// We can now create two connections for different users\n// Both connections will use the globally set 'dbname' option\nvar conn1 = new MDB({user: 'foo', password: 'bar'});\nvar conn2 = new MDB({user: 'dumb', password: '0000'});\n\n// Now let's change a local option of conn1 \n// (which is only possible for non-connection specific options)\nconn1.option(\"setMaxReconnects\", 1);\n```\n\nIn general, the order in which options are consider is:\n1. local\n2. global\n3. default (if available)\n\nThe MonetDB NodeJS module recognizes many options.\nYou do not need to know them all. \nThere is **only one** option that does not have a default value, and that is the database name (dbname).\n\nThe available options can be subdivided into several categories:\n\n\n### Connection options\nThese options are used to make the actual connection to MonetDB. Note that these options can not be changed with the\n[MonetDBConnection.option](#mdbconnection_option) method.\nIf you want to change these settings on an open connection, just construct a new connection.\n\n| Option            | Type      | Default                         | Additional description |\n| :---------------- | :-------- | :------------------------------ | :--------------------- |\n| host              | string    | localhost                       |\n| port              | integer   | 50000                           |\n| dbname            | string    |                                 | No default value for this one.\n| user              | string    | monetdb                         |\n| password          | string    | monetdb                         |\n| language          | string    | sql                             | The language of the issued queries. Should be one of sql/mal.\n| defaultSchema     | string    | sys                             | The default schema to set the connection to after connecting.\n| timezoneOffset    | integer   | offset of current timezone      | The offset in minutes that holds for the required timezone. See [connection timezone](#timezone) for more info.\n\n\n### Reconnection options\nThese options are used to determine how to reconnect whenever a connection fails.\n\n| Option            | Type      | Default                         | Additional description |\n| :----------       | :-------- | :------------------------------ | :--------------------- |\n| maxReconnects     | integer   | 10                              | The maximum number of reconnect attempts after a connection failure. Set to 0 if you do not want to reconnect on connection failures.\n| reconnectTimeout  | integer   | 2000                            | The timeout used in between reconnect attempts.\n\n\n### Query options\nThese options influence the way queries are executed.\n\n| Option            | Type      | Default                         | Additional description |\n| :---------------- | :-------- | :------------------------------ | :--------------------- |\n| prettyResult      | boolean   | false                           | The value for this option will be the default value for how query results are returned. This can be overwritten on a per-query basis. See [pretty results](#pretty) for more info.\n                                                                                          \n### Logging\nThe MonetDB NodeJS module comes with a very extensive logging functionality. It distinguishes between many types of different\nmessages, and allows you to fully customize the way the MonetDB NodeJS module deals with log messages when they occur.\nSee the [logging section](#logging) for more information.\n\n| Option            | Type      | Default                         | Additional description |\n| :---------------- | :-------- | :------------------------------ | :--------------------- |\n| logger            | function  | console.log                     | This function will be used by all of the default logging functions.\n| warnings          | boolean   | true                            | Whether or not to log warnings. **It is highly adviced to keep this set to true, otherwise you will not be notified on e.g. unrecognized options or reconnection attempts.**\n| warningFn         | function  | See [logging section](#logging) | Warning messages will be passed to this function when they occur.\n| debug             | boolean   | false                           | Whether or not to log general debug messages.\n| debugFn           | function  | See [logging section](#logging) | Debug messages will be passed to this function when they occur.\n| debugRequests     | boolean   | false                           | Whether or not to log requests (SQL or MAL) when they resolve.\n| debugRequestFn    | function  | See [logging section](#logging) | SQL or MAL requests, including their results, will be passed to this function when they occur.\n| debugMapi         | boolean   | false                           | Whether or not to show the Mapi messages that are being sent back and forth between the MonetDB NodeJS module and the MonetDB server.\n| debugMapiFn       | function  | See [logging section](#logging) | Mapi messages will be passed to this function when they occur.\n\n\n\n### Testing\nOptions provided solely for testing.\n\n| Option            | Type      | Default                         | Additional description |\n| :---------------- | :-------- | :------------------------------ | :--------------------- |\n| testing           | boolean   | false                           | When set to true, some additional (undocumented) methods will be exposed, e.g. to simulate socket failures.\n\n\n\n\n\n\n\n<a name=\"mdbconnection\"></a>\n# MonetDBConnection\n\nGetting a MonetDBConnection object is easy:\n\n```javascript\nvar MDB = require('monetdb')();\n\n// MDB is a constructor function; let's construct a MonetDBConnection object, shall we?\nvar conn = new MDB({dbname: 'mydb'});\n\n// conn now is a MonetDBConnection object\n```\n\nAll of its exposed attributes and methods are listed here:\n\n\n<a name=\"mdbconnection_constructor\"></a>\n### MonetDBConnection(\\[options\\])\nConstructor for a MonetDBConnection object, that takes an optional options object. For possible options, see the \n[options section](#options).\n\nThrows an error when the provided options object is not ok.\n\n\n\n<a name=\"mdbconnection_mapiconnection\"></a>\n### .mapiConnection\nInstance of MapiConnection. This attribute will be managed by the MonetDBConnection object, so in normal cases you should \nnot use this. Only if you want to e.g. fire raw queries against the database, you might want to reference it directly. \nJust in case you are wondering, \n[here is the documentation](https://github.com/MonetDB/monetdb-nodejs/blob/master/docs/MapiConnection.md).\n\n\n\n<a name=\"mdbconnection_connect\"></a>\n### .connect()\n*This method links to [MapiConnection.connect](https://github.com/MonetDB/monetdb-nodejs/blob/master/docs/MapiConnection.md#connect)*\n\nOpen the connection to the MonetDB server.\n\nReturns a promise that resolves when the connection succeeded, and gets rejected with an error message otherwise.\nNote that you **do not have to wait** for the connection promise to be resolved before issueing queries, since incoming\nqueries will be properly cached.\n\n\n\n### .open()\nAlias for [MonetDBConnection.connect](#mdbconnection_connect).\n\n\n\n<a name=\"mdbconnection_query\"></a>\n### .query(query, \\[params\\], \\[prettyResult\\])\nIssue a query against the database. For a simple example, [see here](#example).\n\n| Argument      | Type          | Required       | Description     |\n| :------------ | :------------ | :------------- | :-------------- |\n| query         | string        | yes            | The query you want to run. In case language is sql, this should be a valid SQL query.\n| params        | array         | no             | If this array is given, a prepared statement will be used under the hood. Very useful if you want to easily protect against SQL injection.\n| prettyResult  | boolean       | no             | If this is set to true, the query result will be prettified. If not given, the default from the options is used. See the [pretty result section](#pretty) for more info.\n                                                   \nExample of a query with parameters:\n```javascript\nvar MDB = require('monetdb')();\n\nvar conn = new MDB({dbname: 'mydb'});\nconn.connect();\n\nconn.query(\n    'SELECT * FROM mytable WHERE c < ? AND d > ?', \n    [40, 102]\n).then(function(result) {\n    // Do something with the result\n});\n```\n\nReturns a promise that resolves with an object with the following properties:\n\n| Property               | Type                   | Description     |\n| :--------------------- | :--------------------- | :-------------- |\n| data                   | array\\[array\\|object\\] | If this is the result of a SELECT query, this property contains the resulting data returned by the database. Every array entry represents one row of the result set. If the 'prettyResult' option was set to true, every array entry will be an object, where the object properties equal the column names. Otherwise, the array entries will be arrays containing just the column values.\n| col                    | object                 | Object maps column names to query result indices. So if you for example did SELECT a, b FROM ... you can access b in a tuple array by issuing tuple[result.col.b], which in this case would resolve to tuple[1].\n| rows                   | integer                | The number of rows in the result set.\n| cols                   | integer                | The number of columns in the result set.\n| structure              | array\\[object\\]        | An array containing an object for every column, with column information.\n| structure\\[i\\].table   | string                 | The name of the table to which column i belongs.\n| structure\\[i\\].column  | string                 | The name of column i.\n| structure\\[i\\].type    | string                 | The database type of column i.\n| structure\\[i\\].typelen | integer                | The length in the database of column i.\n| structure\\[i\\].index   | index                  | The array index of column i, which will equal i.\n| queryid                | integer                | A unique identifier for this query.\n| type                   | string                 | The type of the result (currently only 'table' is supported).\n\n\n### .request(query, \\[params\\], \\[prettyResult\\])\nAlias for [MonetDBConnection.query](#mdbconnection_query).\n\n\n\n<a name=\"mdbconnection_prepare\"></a>\n### .prepare(query, \\[prettyResult\\])\nPrepares a query for repeated execution, and generates execution and release convenience functions.\n\n| Argument      | Type          | Required       | Description     |\n| :------------ | :------------ | :------------- | :-------------- |\n| query         | string        | yes            | The query that has to be prepared. If it does not start with prepare (case insensitive), 'PREPARE ' will be prepended to the query.\n| prettyResult  | boolean       | no             | If this is set to true, the exec function will return prettified results. If not given, the default from the options is used. See the [pretty result section](#pretty) for more info.\n                                                   \nReturns a promise that resolves with an object with the following properties:\n\n| Property               | Type         | Description     |\n| :--------------------- | :----------- | :-------------- |\n| prepare                | object       | The regular query result for the PREPARE statement, as is described under [MonetDBConnection.query](#mdbconnection_query).\n| exec                   | function     | A function that executes the prepared statement. As its first and only argument, it takes an array of values. It returns a promise equivalent to the promise returned by [MonetDBConnection.query](#mdbconnection_query).\n| release                | function     | A parameterless function that you can call when you want to free the resources used by the prepared statement. After calling this function, calls to the exec function will fail. This function **does not** return anything. You cannot be notified of whether or not this worked.\n\nExample:\n\n```javascript\nvar MDB = require('monetdb')();\n\nvar conn = new MDB({dbname: 'mydb'});\nconn.connect();\n\nconn.prepare('SELECT * FROM mytable WHERE c < ? AND d > ?').then(function(prepResult) {\n    // execute query twice\n    prepResult.exec([10, 5]).then(function(result) {\n        // do something with the result\n    });\n    prepResult.exec([50, -20]).then(function(result) {\n        // do something with the result\n    });\n    \n    // we are done, release it (and do not wait for it, release method does not return a promise)\n    prepResult.release();\n});\n```\n\n\n<a name=\"mdbconnection_env\"></a>\n### .env()\nGet the connection environment. Example:\n\n```javascript\nvar MDB = require('monetdb')();\n\nvar conn = new MDB({dbname: 'mydb'});\nconn.connect();\n\nconn.env().then(function(env) {\n    console.log(env);\n});\n```\n\nWill output:\n\n```\n{\n\t\"gdk_dbpath\": \"/home/robin/dbfarm/test\",\n\t\"gdk_debug\": \"0\",\n\t\"gdk_vmtrim\": \"no\",\n    ..\n```\n\n\n<a name=\"mdbconnection_option\"></a>\n### .option(name, [value])\nGet or set an option.\n\n| Argument      | Type                | Required       | Description     |\n| :------------ | :------------------ | :------------- | :-------------- |\n| name          | string              | yes            | The name of the option. See the [option section](#options) for the recognized options.\n| value         | depending on option | no             | If this argument is provided, it is assumed that you want to set the option to this argument. Note that setting options is not possible for connection options. The connection options are mentioned in the [option section](#options).\n\nThrows an error if either the provided option is not found, or if the provided value is invalid.\n\nIf the second argument is omitted, the value of the option is returned.\n\n\n<a name=\"mdbconnection_getstate\"></a>\n### .getState()\n*This method links to [MapiConnection.getState](https://github.com/MonetDB/monetdb-nodejs/blob/master/docs/MapiConnection.md#getstate)*\n\nGet the current state of the connection. For normal usage you will never need to use this.\n\nReturns one of the following state strings:\n\n| State         | Meaning       |\n| :------------ | :------------ |\n| disconnected  | There is currently no open connection, either because it has never been opened yet, or because a reconnect is going on.\n| connected     | There is an open connection to the server, but authentication has not finished yet.\n| ready         | There is an open connection to the server, and we have successfully authenticated. The connection is ready to accept queries.\n| destroyed     | The connection is destroyed, either because it was explicitly destroyed by a call to [MonetDBConnection.destroy](#mdbconnection_destroy), or because of a failure to keep the connection open.\n\nRegardless of the return value of this method, you can safely issue queries to the connection, since they will be properly queued until the connection is ready.\n\n\n\n<a name=\"mdbconnection_close\"></a>\n### .close()\n*This method links to [MapiConnection.close](https://github.com/MonetDB/monetdb-nodejs/blob/master/docs/MapiConnection.md#close)*\n\nFinishes all the current queries in the queue, and then destroys the socket by calling [MonetDBConnection.destroy](#mdbconnection_destroy).\nAfter closing a connection, it cannot be reopened. If reopening is desired, you should create a [new MonetDBConnection object](#mdbconnection_constructor).\n\nWhen queries are issued after calling close, they are still accepted and put into the queue, so a connection remains active\nuntil it becomes idle.\n\nNote that when you have issued a query with parameters, this will under the hood be executed in two steps (one prepare step\nand one execution step). If the close method is called after firing a prepared statement, it might therefore fail because the \nsocket can be destroyed after finishing the first step.\n\nReturns a promise that resolves when all queries in the queue are done and the socket is destroyed.\n\n\n\n### .disconnect()\nAlias for [MonetDBConnection.close](#mdbconnection_close).\n\n\n\n<a name=\"mdbconnection_destroy\"></a>\n### .destroy(\\[msg\\])\n*This method links to [MapiConnection.destroy](https://github.com/MonetDB/monetdb-nodejs/blob/master/docs/MapiConnection.md#destroy)*\n\nFails all queries currently in the queue (including the one that is currently being executed), and destroys the socket.\n\n| Argument      | Type                | Required       | Description     |\n| :------------ | :------------------ | :------------- | :-------------- |\n| msg           | string              | no             | An error message that will be sent to all queries that are rejected. If none is given, a default error message is sent. \n\n\n### .getCallbackWrapper()\nThis method is added for backward compatability. For information on how to use it, see \n[the updates page](https://github.com/MonetDB/monetdb-nodejs/blob/master/docs/update.md#callbackwrapper).\n\n\n\n<a name=\"pretty\"></a>\n# Pretty query results\nBy default, every row in a query result is represented by an array. However, if the pretty flag is set, the query result\nwill instead be an array of objects, where every object has the column names as its properties. This makes using the result\na lot more intuitive and fault-tolerant (e.g. if you hard code indices into row arrays, your code might start failing \nwhen you change the SQL query).\nThe default value of the pretty flag can be overwritten by providing the global or local option 'prettyResult'. Even then,\nyou can override this default value on a per query basis, by providing a boolean value as last argument to either the \n[MonetDBConnection.query](#mdbconnection_query) or the [MonetDBConnection.prepare](#mdbconnection_prepare) function.\nExample:\n\n```javascript\nvar MDB = require('monetdb')();\n\nvar conn = new MDB({dbname: 'mydb'});\nconn.connect();\n\n// we did not set the option 'prettyResult', hence we will pass true to our queries to have them return prettified results.\nconn.query(\"SELECT a, b FROM yourtable\").then(function(result) {\n    console.log(result.data);\n});\n```\n\nOutputs (depending on the values of columnns a and b and the number of resulting tuples):\n```\n[\n    { a: 'val1', b: 'val2' },\n    { a: 'val3', b: 'val4' }\n]\n```\n\n\n\n<a name=\"timezone\"></a>\n# Connection time zone\nFor every connection that is opened to the server, the timezone is automatically set to the current timezone of the system\nthat opens the connection. You can change this behavior by passing a value for the [option 'timezoneOffset'](#options).\nThe value for this option represents the number of minutes to deviate from GMT.\nThis value is used by MonetDB to present timestamps with timezone. Example:\n\n```javascript\nvar MDB = require('monetdb')();\n\n// Create two connections with different time zone\n\n// One GMT+02:00\nvar conn1 = new MDB({timezoneOffset: 120, dbname: 'mydb'});\n\n// And one GMT-03:30 (= -210 minutes)\nvar conn2 = new MDB({timezoneOffset: -210, dbname: 'mydb'});\n\nconn1.connect();\nconn2.connect();\n\nconn1.query('SELECT NOW').then(function(result) {\n    // result.data[0][0] will be something like '2015-11-02 08:11:31.000000+02:00'\n});\n\nconn2.query('SELECT NOW').then(function(result) {\n    // result.data[0][0] will be something like '2015-11-02 02:45:56.000000-03:30'\n});\n```\n\n\n\n<a name=\"logging\"></a>\n# Logging\nAs you can see from the [options section](#options), there are many logging options. By default, only warning messages\nare logged, and console.log is used for this. The following types of log events can occur:\n1. Warnings\n    * Unrecognized options\n    * Connection failures\n    * Queries are issued before calling [connect()](#mdbconnection_connect)\n2. Debug messages\n    * State changes (see \n    [MapiConnection object](https://github.com/MonetDB/monetdb-nodejs/blob/master/docs/MapiConnection.md#getstate)\n    for possible states)\n    * Read/write counts on opened socket\n3. Resolved requests\n4. Mapi messages\n\nYou can manipulate whether or not these events are logged or not, and which functions are used to do this.\nFor all of these events, a default log function is specified in \n[utils.js](https://github.com/MonetDB/monetdb-nodejs/blob/master/src/utils.js)\nEvery log function receives as its first argument the logger that it should use, where the logger simply\ntakes a string and logs it somewhere. By default, the logger is **console.log**. You can change this in\nthe [options](#options).\n\nIn case you want to overwrite the default log functions, here are the function signatures:\n\n### options.warningFn(logger, msg)\n\n| Argument      | Type                 | Description     |\n| :------------ | :------------------- | :-------------- |\n| logger        | function             | The logger that is used, which defaults to console.log but can be specified through the [options](#options).\n| msg           | string               | The message to write to the provided logger.\n\n### options.debugFn(logger, msg)\nSame as options.warningFn\n\n### options.debugRequestFn(logger, request, error, result)\n\n| Argument      | Type                 | Description     |\n| :------------ | :------------------- | :-------------- |\n| logger        | function             | The logger that is used, which defaults to console.log but can be specified through the [options](#options).\n| request       | string               | The request message (SQL query string in case this request is an SQL query)\n| error         | Error|null           | If this request failed, this argument contains the error that was thrown. Otherwise, this argument will be null.\n| result        | Object|null          | If this request passed, this argument contains the [resulting object](#mdbconnection_query).\n\n### options.debugMapiFn(logger, type, msg)\n\n| Argument      | Type                 | Description     |\n| :------------ | :------------------- | :-------------- |\n| logger        | function             | The logger that is used, which defaults to console.log but can be specified through the [options](#options).\n| type          | string               | Either 'TX' for transmitted messages, or 'RX' for received messages.\n| msg           | string               | The string that was communicated over the socket.\n    \n",
  "readmeFilename": "README.md",
  "bugs": {
    "url": "https://github.com/MonetDB/monetdb-nodejs/issues"
  },
  "homepage": "https://github.com/MonetDB/monetdb-nodejs",
  "_id": "monetdb@1.1.1",
  "_shasum": "42a717b667f9a666bb08f7549a07e34416134dde",
  "_from": "monetdb@",
  "_resolved": "https://registry.npmjs.org/monetdb/-/monetdb-1.1.1.tgz"
}
